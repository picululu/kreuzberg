default_install_hook_types:
  - pre-commit
  - commit-msg
exclude: ^docs/snippets/|vendor/|node_modules/|target/|invalid*|dist/|artifacts/|test_documents/|scripts/ci/|packages/.*/tools/vendor-

repos:
  # Commit message linting
  - repo: https://github.com/Goldziher/gitfluff
    rev: v0.8.0
    hooks:
      - id: gitfluff-lint
        args: ["--write"]
        stages: [commit-msg]

  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-merge-conflict
      - id: check-added-large-files
        exclude: uv.lock|docs/benchmarks/app/|crates/kreuzberg-pdfium-render/
      - id: detect-private-key
      - id: check-json
      - id: check-yaml
        args: ["--allow-multiple-documents", "--unsafe"]
      - id: check-toml
      - id: check-case-conflict

  # TOML formatting
  - repo: https://github.com/tox-dev/pyproject-fmt
    rev: "v2.16.2"
    hooks:
      - id: pyproject-fmt

  - repo: https://github.com/ComPWA/taplo-pre-commit
    rev: v0.9.3
    hooks:
      - id: taplo-format
        exclude: "pyproject.toml"

  # Python: ruff (linting + formatting) + mypy (type checking)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.15.2
    hooks:
      - id: ruff
        args: [--fix]
      - id: ruff-format

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.19.1
    hooks:
      - id: mypy
        exclude: "e2e/|scripts/|examples/|tests/test_apps/|benchmarks/"

  # Rust: formatting, linting, and license checking
  - repo: https://github.com/AndrejOrsula/pre-commit-cargo
    rev: 0.5.0
    hooks:
        - id: cargo-fmt
          args: ["--all"]
        - id: cargo-clippy
          args: [
            "--fix",
            "--allow-dirty",
            "--allow-staged",
            "--workspace",
            "--exclude=kreuzberg-php",
            "--all-features",
            "--all-targets",
            "--",
            "-D",
            "warnings",
          ]
        - id: cargo-doc
          args: [ "--no-deps", "--document-private-items" ]
        - id: cargo-fix
          args: [ "--allow-dirty", "--allow-staged" ]

  - repo: https://github.com/bnjbvr/cargo-machete
    rev: v0.9.1
    hooks:
      - id: cargo-machete

  - repo: https://github.com/EmbarkStudios/cargo-deny
    rev: 0.19.0
    hooks:
      - id: cargo-deny
        args: ["check"]

  # JavaScript/TypeScript/JSON/CSS: biome (formatting + linting with autofixes)
  - repo: https://github.com/biomejs/pre-commit
    rev: v2.4.4
    hooks:
      - id: biome-format
        exclude: ^tools/benchmark-harness/fixtures/
      - id: biome-lint

  # C/C++: formatting and linting
  - repo: https://github.com/pocc/pre-commit-hooks
    rev: v1.3.5
    hooks:
      - id: clang-format
        args: [ --style=file ]
        files: (^crates/kreuzberg-ffi/tests/c/|^tools/benchmark-harness/scripts/.*\.c$)
      - id: cppcheck
        args: [ "--std=c11", "--enable=warning,style,performance", "--suppress=missingIncludeSystem" ]
        files: (^crates/kreuzberg-ffi/tests/c/|^tools/benchmark-harness/scripts/.*\.c$)

  - repo: https://github.com/checkmake/checkmake
    rev: v0.3.2
    hooks:
      - id: checkmake

  # Go: formatting and linting (runs per Go module via Taskfile)
  - repo: local
    hooks:
      - id: golangci-lint-full
        name: golangci-lint (all Go modules)
        entry: task go:lint
        language: system
        files: \.go$
        pass_filenames: false

  # Shell scripts: formatting and linting
  - repo: https://github.com/scop/pre-commit-shfmt
    rev: v3.12.0-2
    hooks:
      - id: shfmt
        args: ["-w", "-i", "2"]

  - repo: https://github.com/koalaman/shellcheck-precommit
    rev: v0.11.0
    hooks:
      - id: shellcheck

  # GitHub Actions: linting
  - repo: https://github.com/rhysd/actionlint
    rev: v1.7.11
    hooks:
      - id: actionlint

  # Local hooks for unsupported languages (Ruby, Java, C#, PHP) and custom configurations
  - repo: local
    hooks:

      # Ruby - prek doesn't support Ruby yet
      - id: ruby-format
        name: Ruby formatting (rubocop)
        entry: task ruby:format
        language: system
        files: \.rb$
        pass_filenames: false
        require_serial: true
        stages: [commit]

      - id: ruby-lint
        name: Ruby linting (rubocop + steep)
        entry: task ruby:lint
        language: system
        files: \.(rb|rbs)$
        pass_filenames: false
        require_serial: true
        stages: [commit]

      # Java - prek doesn't support Java
      - id: java-format
        name: Java formatting (spotless)
        entry: task java:format
        language: system
        files: \.java$
        pass_filenames: false
        require_serial: true
        stages: [commit]

      - id: java-lint
        name: Java linting (checkstyle + pmd)
        entry: task java:lint
        language: system
        files: \.java$
        pass_filenames: false
        require_serial: true
        stages: [commit]

      # C# - prek doesn't support C#
      - id: csharp-format
        name: C# formatting (dotnet format)
        entry: task csharp:format
        language: system
        files: \.cs$
        pass_filenames: false
        require_serial: true
        stages: [commit]

      - id: csharp-lint
        name: C# linting (dotnet format)
        entry: task csharp:lint
        language: system
        files: \.cs$
        pass_filenames: false
        require_serial: true
        stages: [commit]

      # PHP - prek doesn't support PHP
      - id: php-format
        name: PHP formatting (php-cs-fixer)
        entry: task php:format
        language: system
        files: \.php$
        pass_filenames: false
        require_serial: true
        stages: [commit]

      - id: php-lint
        name: PHP linting (phpstan + php-cs-fixer)
        entry: task php:lint
        language: system
        files: \.php$
        pass_filenames: false
        require_serial: true
        stages: [commit]

      # R - prek doesn't support R yet
      - id: r-format
        name: R formatting (styler)
        entry: task r:format
        language: system
        files: \.R$
        pass_filenames: false
        require_serial: true
        stages: [commit]

      - id: r-lint
        name: R linting (lintr)
        entry: task r:lint
        language: system
        files: \.R$
        pass_filenames: false
        require_serial: true
        stages: [commit]

      # TypeScript - type checking across all projects (builds WASM + Node first)
      - id: typescript-typecheck
        name: Check TypeScript types
        entry: task typescript:typecheck
        language: system
        files: \.(ts|tsx)$
        pass_filenames: false
        require_serial: true
        stages: [commit]
