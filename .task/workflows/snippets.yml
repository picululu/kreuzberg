version: "3"

vars:
  RUNNER_PATH: "./target/release/snippet-runner"
  SNIPPETS_DIR: "docs/snippets"
  REFERENCE_DIR: "docs/reference"

tasks:
  build:
    desc: Build snippet-runner
    cmds:
      - cargo build --release -p snippet-runner

  list:
    desc: List all documentation snippets
    deps: [build]
    cmds:
      - '{{.RUNNER_PATH}} list --snippets {{.SNIPPETS_DIR}} --reference {{.REFERENCE_DIR}}'

  list:lang:
    desc: List snippets for specific languages (set LANGUAGES=rust,python)
    deps: [build]
    requires:
      vars: [LANGUAGES]
    cmds:
      - '{{.RUNNER_PATH}} list --snippets {{.SNIPPETS_DIR}} --reference {{.REFERENCE_DIR}} --languages {{.LANGUAGES}}'

  validate:syntax:
    desc: Syntax-check all snippets
    deps: [build]
    cmds:
      - '{{.RUNNER_PATH}} validate --snippets {{.SNIPPETS_DIR}} --reference {{.REFERENCE_DIR}} --level syntax'

  validate:compile:
    desc: Compile-check all snippets
    deps: [build]
    cmds:
      - '{{.RUNNER_PATH}} validate --snippets {{.SNIPPETS_DIR}} --reference {{.REFERENCE_DIR}} --level compile'

  validate:run:
    desc: Run all snippets
    deps: [build]
    cmds:
      - '{{.RUNNER_PATH}} validate --snippets {{.SNIPPETS_DIR}} --reference {{.REFERENCE_DIR}} --level run'

  validate:lang:
    desc: Validate snippets for specific languages (set LANGUAGES=rust,python LEVEL=syntax)
    deps: [build]
    requires:
      vars: [LANGUAGES]
    vars:
      LEVEL: '{{ .LEVEL | default "syntax" }}'
    cmds:
      - '{{.RUNNER_PATH}} validate --snippets {{.SNIPPETS_DIR}} --reference {{.REFERENCE_DIR}} --languages {{.LANGUAGES}} --level {{.LEVEL}}'
