# frozen_string_literal: true

# Code generated by kreuzberg-e2e-generator. DO NOT EDIT.
# To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang ruby
#
# Tests for embeddings fixtures.

require_relative 'spec_helper'

RSpec.describe 'embeddings fixtures' do
  it 'embedding_async' do
    E2ERuby.skip_if_feature_unavailable('embeddings')
    E2ERuby.run_fixture_with_method(
      'embedding_async',
      'pdf/fake_memo.pdf',
      { chunking: { embedding: { model: { name: 'balanced', type: 'preset' }, normalize: true }, max_chars: 500,
                    max_overlap: 50 } },
      :async,
      :file,
      requirements: %w[embeddings],
      notes: nil,
      skip_if_missing: true
    ) do |result|
      E2ERuby::Assertions.assert_expected_mime(
        result,
        ['application/pdf']
      )
      E2ERuby::Assertions.assert_min_content_length(result, 10)
      E2ERuby::Assertions.assert_chunks(result, min_count: 1, each_has_content: true, each_has_embedding: true)
    end
  end

  it 'embedding_balanced_preset' do
    E2ERuby.skip_if_feature_unavailable('embeddings')
    E2ERuby.run_fixture(
      'embedding_balanced_preset',
      'pdf/fake_memo.pdf',
      { chunking: { embedding: { model: { name: 'balanced', type: 'preset' }, normalize: true }, max_chars: 500,
                    max_overlap: 50 } },
      requirements: %w[embeddings],
      notes: nil,
      skip_if_missing: true
    ) do |result|
      E2ERuby::Assertions.assert_expected_mime(
        result,
        ['application/pdf']
      )
      E2ERuby::Assertions.assert_min_content_length(result, 10)
      E2ERuby::Assertions.assert_chunks(result, min_count: 1, each_has_content: true, each_has_embedding: true)
    end
  end

  it 'embedding_disabled' do
    E2ERuby.run_fixture(
      'embedding_disabled',
      'pdf/fake_memo.pdf',
      { chunking: { max_chars: 500, max_overlap: 50 } },
      requirements: [],
      notes: nil,
      skip_if_missing: true
    ) do |result|
      E2ERuby::Assertions.assert_expected_mime(
        result,
        ['application/pdf']
      )
      E2ERuby::Assertions.assert_min_content_length(result, 10)
      E2ERuby::Assertions.assert_chunks(result, min_count: 1, each_has_content: true, each_has_embedding: false)
    end
  end

  it 'embedding_fast_preset' do
    E2ERuby.skip_if_feature_unavailable('embeddings')
    E2ERuby.run_fixture(
      'embedding_fast_preset',
      'pdf/fake_memo.pdf',
      { chunking: { embedding: { model: { name: 'fast', type: 'preset' }, normalize: true }, max_chars: 500,
                    max_overlap: 50 } },
      requirements: %w[embeddings],
      notes: nil,
      skip_if_missing: true
    ) do |result|
      E2ERuby::Assertions.assert_expected_mime(
        result,
        ['application/pdf']
      )
      E2ERuby::Assertions.assert_min_content_length(result, 10)
      E2ERuby::Assertions.assert_chunks(result, min_count: 1, each_has_content: true, each_has_embedding: true)
    end
  end
end
