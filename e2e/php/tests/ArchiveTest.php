<?php

declare(strict_types=1);

// Auto-generated tests for archive fixtures.

namespace E2EPhp\Tests;

use E2EPhp\Helpers;
use Kreuzberg\Kreuzberg;
use PHPUnit\Framework\TestCase;

class ArchiveTest extends TestCase
{
    /**
     * 7-Zip archive extraction.
     */
    public function test_archive_sevenz_basic(): void
    {
        $documentPath = Helpers::resolveDocument('archives/documents.7z');
        if (!file_exists($documentPath)) {
            $this->markTestSkipped('Skipping archive_sevenz_basic: missing document at ' . $documentPath);
        }

        $config = Helpers::buildConfig(null);

        $kreuzberg = new Kreuzberg($config);
        $result = $kreuzberg->extractFile($documentPath);

        Helpers::assertExpectedMime($result, ['application/x-7z-compressed']);
        Helpers::assertMinContentLength($result, 10);
    }

    /**
     * TAR archive extraction.
     */
    public function test_archive_tar_basic(): void
    {
        $documentPath = Helpers::resolveDocument('archives/documents.tar');
        if (!file_exists($documentPath)) {
            $this->markTestSkipped('Skipping archive_tar_basic: missing document at ' . $documentPath);
        }

        $config = Helpers::buildConfig(null);

        $kreuzberg = new Kreuzberg($config);
        $result = $kreuzberg->extractFile($documentPath);

        Helpers::assertExpectedMime($result, ['application/x-tar', 'application/tar']);
        Helpers::assertMinContentLength($result, 10);
    }

    /**
     * ZIP archive extraction.
     */
    public function test_archive_zip_basic(): void
    {
        $documentPath = Helpers::resolveDocument('archives/documents.zip');
        if (!file_exists($documentPath)) {
            $this->markTestSkipped('Skipping archive_zip_basic: missing document at ' . $documentPath);
        }

        $config = Helpers::buildConfig(null);

        $kreuzberg = new Kreuzberg($config);
        $result = $kreuzberg->extractFile($documentPath);

        Helpers::assertExpectedMime($result, ['application/zip', 'application/x-zip-compressed']);
        Helpers::assertMinContentLength($result, 10);
    }

}
