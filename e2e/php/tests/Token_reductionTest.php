<?php

declare(strict_types=1);

// Code generated by kreuzberg-e2e-generator. DO NOT EDIT.
// To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang php

// Tests for token_reduction fixtures.

namespace E2EPhp\Tests;

use E2EPhp\Helpers;
use Kreuzberg\Kreuzberg;
use PHPUnit\Framework\TestCase;

class Token_reductionTest extends TestCase
{
    /**
     * Tests basic token reduction on PDF document
     */
    public function test_token_reduction_basic(): void
    {
        $documentPath = Helpers::resolveDocument('pdf/fake_memo.pdf');
        if (!file_exists($documentPath)) {
            $this->markTestSkipped('Skipping token_reduction_basic: missing document at ' . $documentPath);
        }

        $config = Helpers::buildConfig(['token_reduction' => ['level' => 'medium']]);

        $kreuzberg = new Kreuzberg($config);
        $result = $kreuzberg->extractFile($documentPath);

        Helpers::assertExpectedMime($result, ['application/pdf']);
        Helpers::assertMinContentLength($result, 5);
        Helpers::assertContentNotEmpty($result);
    }

    /**
     * Tests token reduction combined with chunking
     */
    public function test_token_reduction_with_chunking(): void
    {
        $documentPath = Helpers::resolveDocument('pdf/fake_memo.pdf');
        if (!file_exists($documentPath)) {
            $this->markTestSkipped('Skipping token_reduction_with_chunking: missing document at ' . $documentPath);
        }

        $config = Helpers::buildConfig(['chunking' => ['max_chars' => 500, 'max_overlap' => 50], 'token_reduction' => ['level' => 'medium']]);

        $kreuzberg = new Kreuzberg($config);
        $result = $kreuzberg->extractFile($documentPath);

        Helpers::assertExpectedMime($result, ['application/pdf']);
        Helpers::assertMinContentLength($result, 5);
        Helpers::assertChunks($result, 1, null, true, null);
        Helpers::assertContentNotEmpty($result);
    }

}
