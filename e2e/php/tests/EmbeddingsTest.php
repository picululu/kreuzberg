<?php

declare(strict_types=1);

// Code generated by kreuzberg-e2e-generator. DO NOT EDIT.
// To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang php

// Tests for embeddings fixtures.

namespace E2EPhp\Tests;

use E2EPhp\Helpers;
use Kreuzberg\Kreuzberg;
use PHPUnit\Framework\TestCase;

class EmbeddingsTest extends TestCase
{
    /**
     * Tests embedding generation via async extraction path
     */
    public function test_embedding_async(): void
    {
        $documentPath = Helpers::resolveDocument('pdf/fake_memo.pdf');
        if (!file_exists($documentPath)) {
            $this->markTestSkipped('Skipping embedding_async: missing document at ' . $documentPath);
        }

        $config = Helpers::buildConfig(['chunking' => ['embedding' => ['model' => ['preset' => 'balanced'], 'normalize' => true], 'max_chars' => 500, 'max_overlap' => 50]]);

        $kreuzberg = new Kreuzberg($config);
        $result = $kreuzberg->extractFile($documentPath);

        Helpers::assertExpectedMime($result, ['application/pdf']);
        Helpers::assertMinContentLength($result, 10);
        Helpers::assertChunks($result, 1, null, true, true);
    }

    /**
     * Tests embedding generation with balanced preset model via chunking
     */
    public function test_embedding_balanced_preset(): void
    {
        $documentPath = Helpers::resolveDocument('pdf/fake_memo.pdf');
        if (!file_exists($documentPath)) {
            $this->markTestSkipped('Skipping embedding_balanced_preset: missing document at ' . $documentPath);
        }

        $config = Helpers::buildConfig(['chunking' => ['embedding' => ['model' => ['preset' => 'balanced'], 'normalize' => true], 'max_chars' => 500, 'max_overlap' => 50]]);

        $kreuzberg = new Kreuzberg($config);
        $result = $kreuzberg->extractFile($documentPath);

        Helpers::assertExpectedMime($result, ['application/pdf']);
        Helpers::assertMinContentLength($result, 10);
        Helpers::assertChunks($result, 1, null, true, true);
    }

    /**
     * Tests chunking without embeddings - chunks should not have embedding vectors
     */
    public function test_embedding_disabled(): void
    {
        $documentPath = Helpers::resolveDocument('pdf/fake_memo.pdf');
        if (!file_exists($documentPath)) {
            $this->markTestSkipped('Skipping embedding_disabled: missing document at ' . $documentPath);
        }

        $config = Helpers::buildConfig(['chunking' => ['max_chars' => 500, 'max_overlap' => 50]]);

        $kreuzberg = new Kreuzberg($config);
        $result = $kreuzberg->extractFile($documentPath);

        Helpers::assertExpectedMime($result, ['application/pdf']);
        Helpers::assertMinContentLength($result, 10);
        Helpers::assertChunks($result, 1, null, true, false);
    }

    /**
     * Tests embedding generation with fast preset model
     */
    public function test_embedding_fast_preset(): void
    {
        $documentPath = Helpers::resolveDocument('pdf/fake_memo.pdf');
        if (!file_exists($documentPath)) {
            $this->markTestSkipped('Skipping embedding_fast_preset: missing document at ' . $documentPath);
        }

        $config = Helpers::buildConfig(['chunking' => ['embedding' => ['model' => ['preset' => 'fast'], 'normalize' => true], 'max_chars' => 500, 'max_overlap' => 50]]);

        $kreuzberg = new Kreuzberg($config);
        $result = $kreuzberg->extractFile($documentPath);

        Helpers::assertExpectedMime($result, ['application/pdf']);
        Helpers::assertMinContentLength($result, 10);
        Helpers::assertChunks($result, 1, null, true, true);
    }

}
