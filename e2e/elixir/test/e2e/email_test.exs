# Auto-generated tests for email fixtures.

# To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang elixir

defmodule E2E.EmailTest do
  use ExUnit.Case, async: false

  describe "email fixtures" do
    test "email_eml_html_body" do
      case E2E.Helpers.run_fixture(
        "email_eml_html_body",
        "email/html_only.eml",
        nil,
        requirements: [],
        notes: nil,
        skip_if_missing: true
      ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["message/rfc822"])
          |> E2E.Helpers.assert_min_content_length(10)

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end

    test "email_eml_multipart" do
      case E2E.Helpers.run_fixture(
        "email_eml_multipart",
        "email/html_email_multipart.eml",
        nil,
        requirements: [],
        notes: nil,
        skip_if_missing: true
      ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["message/rfc822"])
          |> E2E.Helpers.assert_min_content_length(10)

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end

    test "email_eml_utf16" do
      case E2E.Helpers.run_fixture(
        "email_eml_utf16",
        "vendored/unstructured/eml/fake-email-utf-16.eml",
        nil,
        requirements: [],
        notes: nil,
        skip_if_missing: true
      ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["message/rfc822"])
          |> E2E.Helpers.assert_min_content_length(50)
          |> E2E.Helpers.assert_content_contains_any(["Test Email", "Roses are red"])

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end

    test "email_msg_basic" do
      case E2E.Helpers.run_fixture(
        "email_msg_basic",
        "email/fake_email.msg",
        nil,
        requirements: [],
        notes: nil,
        skip_if_missing: true
      ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["application/vnd.ms-outlook"])
          |> E2E.Helpers.assert_min_content_length(10)

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end

    test "email_sample_eml" do
      case E2E.Helpers.run_fixture(
        "email_sample_eml",
        "email/sample_email.eml",
        nil,
        requirements: [],
        notes: nil,
        skip_if_missing: true
      ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["message/rfc822"])
          |> E2E.Helpers.assert_min_content_length(20)

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end
  end
end
