# Auto-generated tests for archive fixtures.

# To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang elixir

defmodule E2E.ArchiveTest do
  use ExUnit.Case, async: false

  describe "archive fixtures" do
    test "archive_sevenz_basic" do
      case E2E.Helpers.run_fixture(
        "archive_sevenz_basic",
        "archives/documents.7z",
        nil,
        requirements: [],
        notes: nil,
        skip_if_missing: true
      ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["application/x-7z-compressed"])
          |> E2E.Helpers.assert_min_content_length(10)

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end

    test "archive_tar_basic" do
      case E2E.Helpers.run_fixture(
        "archive_tar_basic",
        "archives/documents.tar",
        nil,
        requirements: [],
        notes: nil,
        skip_if_missing: true
      ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["application/x-tar", "application/tar"])
          |> E2E.Helpers.assert_min_content_length(10)

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end

    test "archive_zip_basic" do
      case E2E.Helpers.run_fixture(
        "archive_zip_basic",
        "archives/documents.zip",
        nil,
        requirements: [],
        notes: nil,
        skip_if_missing: true
      ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["application/zip", "application/x-zip-compressed"])
          |> E2E.Helpers.assert_min_content_length(10)

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end
  end
end
