# Code generated by kreuzberg-e2e-generator. DO NOT EDIT.
# To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang elixir
#
# Tests for embeddings fixtures.

# To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang elixir

defmodule E2E.EmbeddingsTest do
  use ExUnit.Case, async: false

  describe "embeddings fixtures" do
    test "embedding_async" do
      case E2E.Helpers.run_fixture_with_method(
             "embedding_async",
             "pdf/fake_memo.pdf",
             %{
               chunking: %{embedding: %{model: %{preset: "balanced"}, normalize: true}, max_chars: 500, max_overlap: 50}
             },
             :async,
             :file,
             requirements: ["embeddings"],
             notes: nil,
             skip_if_missing: true
           ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["application/pdf"])
          |> E2E.Helpers.assert_min_content_length(10)
          |> E2E.Helpers.assert_chunks(min_count: 1, each_has_content: true, each_has_embedding: true)

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end

    test "embedding_balanced_preset" do
      case E2E.Helpers.run_fixture(
             "embedding_balanced_preset",
             "pdf/fake_memo.pdf",
             %{
               chunking: %{embedding: %{model: %{preset: "balanced"}, normalize: true}, max_chars: 500, max_overlap: 50}
             },
             requirements: ["embeddings"],
             notes: nil,
             skip_if_missing: true
           ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["application/pdf"])
          |> E2E.Helpers.assert_min_content_length(10)
          |> E2E.Helpers.assert_chunks(min_count: 1, each_has_content: true, each_has_embedding: true)

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end

    test "embedding_disabled" do
      case E2E.Helpers.run_fixture(
             "embedding_disabled",
             "pdf/fake_memo.pdf",
             %{chunking: %{max_chars: 500, max_overlap: 50}},
             requirements: [],
             notes: nil,
             skip_if_missing: true
           ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["application/pdf"])
          |> E2E.Helpers.assert_min_content_length(10)
          |> E2E.Helpers.assert_chunks(min_count: 1, each_has_content: true, each_has_embedding: false)

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end

    test "embedding_fast_preset" do
      case E2E.Helpers.run_fixture(
             "embedding_fast_preset",
             "pdf/fake_memo.pdf",
             %{chunking: %{embedding: %{model: %{preset: "fast"}, normalize: true}, max_chars: 500, max_overlap: 50}},
             requirements: ["embeddings"],
             notes: nil,
             skip_if_missing: true
           ) do
        {:ok, result} ->
          result
          |> E2E.Helpers.assert_expected_mime(["application/pdf"])
          |> E2E.Helpers.assert_min_content_length(10)
          |> E2E.Helpers.assert_chunks(min_count: 1, each_has_content: true, each_has_embedding: true)

        {:skipped, reason} ->
          IO.puts("SKIPPED: #{reason}")

        {:error, reason} ->
          flunk("Extraction failed: #{inspect(reason)}")
      end
    end
  end
end
