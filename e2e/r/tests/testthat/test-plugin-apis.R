# Code generated by kreuzberg-e2e-generator. DO NOT EDIT.
# To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang r
# nolint start

library(testthat)
library(kreuzberg)

test_that("Configuration API tests", {
  # Discover configuration from current or parent directories
  withr::with_tempdir({
    tmpdir <- getwd()
    config_path <- file.path(tmpdir, "kreuzberg.toml")
    writeLines(c(
      "[chunking]", "max_chars = 50"
    ), config_path)

    subdir <- file.path(tmpdir, "subdir")
    dir.create(subdir, recursive = TRUE)

    withr::with_dir(subdir, {
      config <- discover()
      expect_false(is.null(config$chunking))
      expect_equal(config$chunking$max_chars, 50)
    })
  })

  # Load configuration from a TOML file
  withr::with_tempdir({
    tmpdir <- getwd()
    config_path <- file.path(tmpdir, "test_config.toml")
    writeLines(c(
      "[chunking]", "max_chars = 100", "max_overlap = 20", "", "[language_detection]", "enabled = false"
    ), config_path)

    config <- from_file(config_path)
    expect_false(is.null(config$chunking))
    expect_equal(config$chunking$max_chars, 100)
    expect_equal(config$chunking$max_overlap, 20)
    expect_false(is.null(config$language_detection))
    expect_equal(config$language_detection$enabled, FALSE)
  })
})

test_that("Document Extractor Management API tests", {
  # Clear all document extractors and verify list is empty
  clear_document_extractors()
  result <- list_document_extractors()
  expect_length(result, 0L)

  # List all registered document extractors
  result <- list_document_extractors()
  expect_true(is.character(result) || is.list(result))

  # Unregister nonexistent document extractor gracefully
  expect_no_error(unregister_document_extractor("nonexistent-extractor-xyz"))
})

test_that("Mime Utilities API tests", {
  # Detect MIME type from file bytes
  test_bytes <- charToRaw("%PDF-1.4\\n")
  result <- detect_mime_type(test_bytes)
  expect_true(grepl("pdf", tolower(result), fixed = TRUE))

  # Detect MIME type from file path
  withr::with_tempdir({
    tmpdir <- getwd()
    test_file <- file.path(tmpdir, "test.txt")
    writeLines("Hello, world!", test_file)

    result <- detect_mime_type_from_path(test_file)
    expect_true(grepl("text", tolower(result), fixed = TRUE))
  })

  # Get file extensions for a MIME type
  result <- get_extensions_for_mime("application/pdf")
  expect_true(is.character(result))
  expect_true("pdf" %in% result)
})

test_that("Ocr Backend Management API tests", {
  # Clear all OCR backends and verify list is empty
  clear_ocr_backends()
  result <- list_ocr_backends()
  expect_length(result, 0L)

  # List all registered OCR backends
  result <- list_ocr_backends()
  expect_true(is.character(result) || is.list(result))

  # Unregister nonexistent OCR backend gracefully
  expect_no_error(unregister_ocr_backend("nonexistent-backend-xyz"))
})

test_that("Post Processor Management API tests", {
  # Clear all post-processors and verify list is empty
  clear_post_processors()

  # List all registered post-processors
  result <- list_post_processors()
  expect_true(is.character(result) || is.list(result))
})

test_that("Validator Management API tests", {
  # Clear all validators and verify list is empty
  clear_validators()
  result <- list_validators()
  expect_length(result, 0L)

  # List all registered validators
  result <- list_validators()
  expect_true(is.character(result) || is.list(result))
})

# nolint end
