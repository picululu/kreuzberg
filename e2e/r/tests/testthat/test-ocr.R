# Code generated by kreuzberg-e2e-generator. DO NOT EDIT.
# To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang r
#
# Tests for ocr fixtures.
# nolint start

test_that("ocr_image_hello_world", {
  skip_if_feature_unavailable("tesseract")
  result <- run_fixture(
    "ocr_image_hello_world",
    "images/test_hello_world.png",
    list(force_ocr = TRUE, ocr = list(backend = "tesseract", language = "eng")),
    requirements = c("tesseract", "tesseract"),
    notes = "Requires Tesseract OCR for image text extraction.",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("image/png"))
  assert_min_content_length(result, 5L)
  assert_content_contains_any(result, c("hello", "world"))
})

test_that("ocr_image_no_text", {
  skip_if_feature_unavailable("tesseract")
  result <- run_fixture(
    "ocr_image_no_text",
    "images/flower_no_text.jpg",
    list(force_ocr = TRUE, ocr = list(backend = "tesseract", language = "eng")),
    requirements = c("tesseract", "tesseract"),
    notes = "Skip when Tesseract is unavailable.",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("image/jpeg"))
  assert_max_content_length(result, 200L)
})

test_that("ocr_paddle_confidence_filter", {
  skip_if_feature_unavailable("paddle-ocr")
  skip_if_feature_unavailable("paddle-ocr")
  result <- run_fixture(
    "ocr_paddle_confidence_filter",
    "images/ocr_image.jpg",
    list(force_ocr = TRUE, ocr = list(backend = "paddle-ocr", language = "en", paddle_ocr_config = list(min_confidence = 80.0))),
    requirements = c("paddle-ocr", "paddle-ocr", "onnxruntime"),
    notes = "Tests confidence threshold filtering with PaddleOCR",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("image/jpeg"))
  assert_min_content_length(result, 1L)
})

test_that("ocr_paddle_element_hierarchy", {
  skip_if_feature_unavailable("paddle-ocr")
  skip_if_feature_unavailable("paddle-ocr")
  result <- run_fixture(
    "ocr_paddle_element_hierarchy",
    "images/test_hello_world.png",
    list(force_ocr = TRUE, ocr = list(backend = "paddle-ocr", element_config = list(build_hierarchy = TRUE, include_elements = TRUE), language = "en")),
    requirements = c("paddle-ocr", "paddle-ocr", "onnxruntime"),
    notes = "Requires PaddleOCR with ONNX Runtime",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("image/png"))
  assert_min_content_length(result, 5L)
  assert_ocr_elements(result, has_elements = TRUE, elements_have_geometry = TRUE, elements_have_confidence = TRUE)
})

test_that("ocr_paddle_element_levels", {
  skip_if_feature_unavailable("paddle-ocr")
  skip_if_feature_unavailable("paddle-ocr")
  result <- run_fixture(
    "ocr_paddle_element_levels",
    "images/test_hello_world.png",
    list(force_ocr = TRUE, ocr = list(backend = "paddle-ocr", element_config = list(include_elements = TRUE, min_level = "word"), language = "en")),
    requirements = c("paddle-ocr", "paddle-ocr", "onnxruntime"),
    notes = "Requires PaddleOCR with ONNX Runtime",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("image/png"))
  assert_min_content_length(result, 5L)
  assert_ocr_elements(result, has_elements = TRUE, elements_have_geometry = TRUE, min_count = 1L)
})

test_that("ocr_paddle_image_chinese", {
  skip_if_feature_unavailable("paddle-ocr")
  skip_if_feature_unavailable("paddle-ocr")
  result <- run_fixture(
    "ocr_paddle_image_chinese",
    "images/chi_sim_image.jpeg",
    list(force_ocr = TRUE, ocr = list(backend = "paddle-ocr", language = "ch")),
    requirements = c("paddle-ocr", "paddle-ocr", "onnxruntime"),
    notes = "Requires PaddleOCR with Chinese models",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("image/jpeg"))
  assert_min_content_length(result, 1L)
})

test_that("ocr_paddle_image_english", {
  skip_if_feature_unavailable("paddle-ocr")
  skip_if_feature_unavailable("paddle-ocr")
  result <- run_fixture(
    "ocr_paddle_image_english",
    "images/test_hello_world.png",
    list(force_ocr = TRUE, ocr = list(backend = "paddle-ocr", language = "en")),
    requirements = c("paddle-ocr", "paddle-ocr", "onnxruntime"),
    notes = "Requires PaddleOCR with ONNX Runtime",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("image/png"))
  assert_min_content_length(result, 5L)
  assert_content_contains_any(result, c("hello", "Hello", "world", "World"))
})

test_that("ocr_paddle_markdown", {
  skip_if_feature_unavailable("paddle-ocr")
  skip_if_feature_unavailable("paddle-ocr")
  result <- run_fixture(
    "ocr_paddle_markdown",
    "images/test_hello_world.png",
    list(force_ocr = TRUE, ocr = list(backend = "paddle-ocr", language = "en", paddle_ocr_config = list(output_format = "markdown"))),
    requirements = c("paddle-ocr", "paddle-ocr", "onnxruntime"),
    notes = "Tests markdown output format parity with Tesseract",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("image/png"))
  assert_min_content_length(result, 5L)
  assert_content_contains_any(result, c("hello", "Hello", "world", "World"))
})

test_that("ocr_paddle_pdf_scanned", {
  skip_if_feature_unavailable("paddle-ocr")
  skip_if_feature_unavailable("paddle-ocr")
  result <- run_fixture(
    "ocr_paddle_pdf_scanned",
    "pdf/ocr_test.pdf",
    list(force_ocr = TRUE, ocr = list(backend = "paddle-ocr", language = "en")),
    requirements = c("paddle-ocr", "paddle-ocr", "onnxruntime"),
    notes = "Requires PaddleOCR with ONNX Runtime",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("application/pdf"))
  assert_min_content_length(result, 20L)
  assert_content_contains_any(result, c("Docling", "Markdown", "JSON"))
})

test_that("ocr_paddle_structured", {
  skip_if_feature_unavailable("paddle-ocr")
  skip_if_feature_unavailable("paddle-ocr")
  result <- run_fixture(
    "ocr_paddle_structured",
    "images/test_hello_world.png",
    list(force_ocr = TRUE, ocr = list(backend = "paddle-ocr", element_config = list(include_elements = TRUE), language = "en")),
    requirements = c("paddle-ocr", "paddle-ocr", "onnxruntime"),
    notes = "Tests structured output with bbox/confidence preservation",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("image/png"))
  assert_min_content_length(result, 5L)
  assert_ocr_elements(result, has_elements = TRUE, elements_have_geometry = TRUE, elements_have_confidence = TRUE)
})

test_that("ocr_paddle_table_detection", {
  skip_if_feature_unavailable("paddle-ocr")
  skip_if_feature_unavailable("paddle-ocr")
  result <- run_fixture(
    "ocr_paddle_table_detection",
    "images/simple_table.png",
    list(force_ocr = TRUE, ocr = list(backend = "paddle-ocr", language = "en", paddle_ocr_config = list(enable_table_detection = TRUE))),
    requirements = c("paddle-ocr", "paddle-ocr", "onnxruntime"),
    notes = "Tests table detection capability with PaddleOCR",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("image/png"))
  assert_min_content_length(result, 10L)
  assert_table_count(result, minimum = 1L, maximum = NULL)
})

test_that("ocr_pdf_image_only_german", {
  skip_if_feature_unavailable("tesseract")
  result <- run_fixture(
    "ocr_pdf_image_only_german",
    "pdf/image_only_german_pdf.pdf",
    list(force_ocr = TRUE, ocr = list(backend = "tesseract", language = "deu")),
    requirements = c("tesseract", "tesseract"),
    notes = "Requires Tesseract OCR with German language data.",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("application/pdf"))
  assert_min_content_length(result, 20L)
  assert_metadata_expectation(result, "format_type", list(eq = "pdf"))
})

test_that("ocr_pdf_rotated_90", {
  skip_if_feature_unavailable("tesseract")
  result <- run_fixture(
    "ocr_pdf_rotated_90",
    "pdf/ocr_test_rotated_90.pdf",
    list(force_ocr = TRUE, ocr = list(backend = "tesseract", language = "eng")),
    requirements = c("tesseract", "tesseract"),
    notes = "Skip automatically when OCR backend is missing.",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("application/pdf"))
  assert_min_content_length(result, 10L)
})

test_that("ocr_pdf_tesseract", {
  skip_if_feature_unavailable("tesseract")
  result <- run_fixture(
    "ocr_pdf_tesseract",
    "pdf/ocr_test.pdf",
    list(force_ocr = TRUE, ocr = list(backend = "tesseract", language = "eng")),
    requirements = c("tesseract", "tesseract"),
    notes = "Skip automatically if OCR backend is unavailable.",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("application/pdf"))
  assert_min_content_length(result, 20L)
  assert_content_contains_any(result, c("Docling", "Markdown", "JSON"))
})

test_that("ocr_tesseract_elements", {
  skip_if_feature_unavailable("tesseract")
  result <- run_fixture(
    "ocr_tesseract_elements",
    "images/test_hello_world.png",
    list(force_ocr = TRUE, ocr = list(backend = "tesseract", element_config = list(include_elements = TRUE), language = "eng")),
    requirements = c("tesseract", "tesseract"),
    notes = "Requires Tesseract OCR backend",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("image/png"))
  assert_min_content_length(result, 5L)
  assert_ocr_elements(result, has_elements = TRUE, elements_have_geometry = TRUE, elements_have_confidence = TRUE)
})

test_that("ocr_tesseract_language_german", {
  skip_if_feature_unavailable("tesseract")
  result <- run_fixture(
    "ocr_tesseract_language_german",
    "pdf/image_only_german_pdf.pdf",
    list(force_ocr = TRUE, ocr = list(backend = "tesseract", language = "deu")),
    requirements = c("tesseract", "tesseract"),
    notes = "Requires Tesseract OCR with German language data (deu)",
    skip_if_missing = TRUE
  )
  assert_expected_mime(result, c("application/pdf"))
  assert_min_content_length(result, 20L)
})
# nolint end
