# Code generated by kreuzberg-e2e-generator. DO NOT EDIT.
# To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang python
#
# Tests for token_reduction fixtures.
from __future__ import annotations

import pytest

from kreuzberg import (
    extract_file_sync,
)

from . import helpers


def test_token_reduction_basic() -> None:
    """Tests basic token reduction on PDF document"""

    document_path = helpers.resolve_document("pdf/fake_memo.pdf")
    if not document_path.exists():
        pytest.skip(f"Skipping token_reduction_basic: missing document at {document_path}")

    config = helpers.build_config({"token_reduction": {"level": "medium"}})

    result = extract_file_sync(document_path, None, config)

    helpers.assert_expected_mime(result, ["application/pdf"])
    helpers.assert_min_content_length(result, 5)
    helpers.assert_content_not_empty(result)


def test_token_reduction_with_chunking() -> None:
    """Tests token reduction combined with chunking"""

    document_path = helpers.resolve_document("pdf/fake_memo.pdf")
    if not document_path.exists():
        pytest.skip(f"Skipping token_reduction_with_chunking: missing document at {document_path}")

    config = helpers.build_config(
        {"chunking": {"max_chars": 500, "max_overlap": 50}, "token_reduction": {"level": "medium"}}
    )

    result = extract_file_sync(document_path, None, config)

    helpers.assert_expected_mime(result, ["application/pdf"])
    helpers.assert_min_content_length(result, 5)
    helpers.assert_chunks(result, min_count=1, each_has_content=True)
    helpers.assert_content_not_empty(result)
