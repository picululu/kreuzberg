# Code generated by kreuzberg-e2e-generator. DO NOT EDIT.
# To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang python
#
# Tests for embeddings fixtures.
from __future__ import annotations

import pytest

from kreuzberg import (
    extract_file,
    extract_file_sync,
)

from . import helpers


@pytest.mark.asyncio
async def test_embedding_async() -> None:
    """Tests embedding generation via async extraction path"""

    document_path = helpers.resolve_document("pdf/fake_memo.pdf")
    if not document_path.exists():
        pytest.skip(f"Skipping embedding_async: missing document at {document_path}")

    config = helpers.build_config(
        {
            "chunking": {
                "embedding": {"model": {"preset": "balanced"}, "normalize": True},
                "max_chars": 500,
                "max_overlap": 50,
            }
        }
    )

    result = await extract_file(document_path, None, config)

    helpers.assert_expected_mime(result, ["application/pdf"])
    helpers.assert_min_content_length(result, 10)
    helpers.assert_chunks(result, min_count=1, each_has_content=True, each_has_embedding=True)


def test_embedding_balanced_preset() -> None:
    """Tests embedding generation with balanced preset model via chunking"""

    document_path = helpers.resolve_document("pdf/fake_memo.pdf")
    if not document_path.exists():
        pytest.skip(f"Skipping embedding_balanced_preset: missing document at {document_path}")

    config = helpers.build_config(
        {
            "chunking": {
                "embedding": {"model": {"preset": "balanced"}, "normalize": True},
                "max_chars": 500,
                "max_overlap": 50,
            }
        }
    )

    result = extract_file_sync(document_path, None, config)

    helpers.assert_expected_mime(result, ["application/pdf"])
    helpers.assert_min_content_length(result, 10)
    helpers.assert_chunks(result, min_count=1, each_has_content=True, each_has_embedding=True)


def test_embedding_disabled() -> None:
    """Tests chunking without embeddings - chunks should not have embedding vectors"""

    document_path = helpers.resolve_document("pdf/fake_memo.pdf")
    if not document_path.exists():
        pytest.skip(f"Skipping embedding_disabled: missing document at {document_path}")

    config = helpers.build_config({"chunking": {"max_chars": 500, "max_overlap": 50}})

    result = extract_file_sync(document_path, None, config)

    helpers.assert_expected_mime(result, ["application/pdf"])
    helpers.assert_min_content_length(result, 10)
    helpers.assert_chunks(result, min_count=1, each_has_content=True, each_has_embedding=False)


def test_embedding_fast_preset() -> None:
    """Tests embedding generation with fast preset model"""

    document_path = helpers.resolve_document("pdf/fake_memo.pdf")
    if not document_path.exists():
        pytest.skip(f"Skipping embedding_fast_preset: missing document at {document_path}")

    config = helpers.build_config(
        {
            "chunking": {
                "embedding": {"model": {"preset": "fast"}, "normalize": True},
                "max_chars": 500,
                "max_overlap": 50,
            }
        }
    )

    result = extract_file_sync(document_path, None, config)

    helpers.assert_expected_mime(result, ["application/pdf"])
    helpers.assert_min_content_length(result, 10)
    helpers.assert_chunks(result, min_count=1, each_has_content=True, each_has_embedding=True)
