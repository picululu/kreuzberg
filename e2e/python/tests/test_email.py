# Auto-generated tests for email fixtures.
from __future__ import annotations

import pytest

from kreuzberg import (
    extract_file_sync,
)

from . import helpers


def test_email_eml_html_body() -> None:
    """EML with HTML body content."""

    document_path = helpers.resolve_document("email/html_only.eml")
    if not document_path.exists():
        pytest.skip(f"Skipping email_eml_html_body: missing document at {document_path}")

    config = helpers.build_config(None)

    result = extract_file_sync(document_path, None, config)

    helpers.assert_expected_mime(result, ["message/rfc822"])
    helpers.assert_min_content_length(result, 10)


def test_email_eml_multipart() -> None:
    """EML with multipart MIME content."""

    document_path = helpers.resolve_document("email/html_email_multipart.eml")
    if not document_path.exists():
        pytest.skip(f"Skipping email_eml_multipart: missing document at {document_path}")

    config = helpers.build_config(None)

    result = extract_file_sync(document_path, None, config)

    helpers.assert_expected_mime(result, ["message/rfc822"])
    helpers.assert_min_content_length(result, 10)


def test_email_eml_utf16() -> None:
    """UTF-16 encoded EML file with BOM."""

    document_path = helpers.resolve_document("vendored/unstructured/eml/fake-email-utf-16.eml")
    if not document_path.exists():
        pytest.skip(f"Skipping email_eml_utf16: missing document at {document_path}")

    config = helpers.build_config(None)

    result = extract_file_sync(document_path, None, config)

    helpers.assert_expected_mime(result, ["message/rfc822"])
    helpers.assert_min_content_length(result, 50)
    helpers.assert_content_contains_any(result, ["Test Email", "Roses are red"])


def test_email_msg_basic() -> None:
    """Outlook MSG file extraction."""

    document_path = helpers.resolve_document("email/fake_email.msg")
    if not document_path.exists():
        pytest.skip(f"Skipping email_msg_basic: missing document at {document_path}")

    config = helpers.build_config(None)

    result = extract_file_sync(document_path, None, config)

    helpers.assert_expected_mime(result, ["application/vnd.ms-outlook"])
    helpers.assert_min_content_length(result, 10)


def test_email_sample_eml() -> None:
    """Sample EML email file to verify email parsing."""

    document_path = helpers.resolve_document("email/sample_email.eml")
    if not document_path.exists():
        pytest.skip(f"Skipping email_sample_eml: missing document at {document_path}")

    config = helpers.build_config(None)

    result = extract_file_sync(document_path, None, config)

    helpers.assert_expected_mime(result, ["message/rfc822"])
    helpers.assert_min_content_length(result, 20)
