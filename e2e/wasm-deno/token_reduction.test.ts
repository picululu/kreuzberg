// Code generated by kreuzberg-e2e-generator. DO NOT EDIT.
// To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang wasm-deno

// Tests for token_reduction fixtures. Run with: deno test --allow-read

import type { ExtractionResult } from "./helpers.ts";
import { assertions, buildConfig, extractBytes, initWasm, resolveDocument, shouldSkipFixture } from "./helpers.ts";

// Initialize WASM module once at module load time
await initWasm();

Deno.test("token_reduction_basic", { permissions: { read: true } }, async () => {
	const documentBytes = await resolveDocument("pdf/fake_memo.pdf");
	const config = buildConfig({ token_reduction: { level: "medium" } });
	let result: ExtractionResult | null = null;
	try {
		// Sync file extraction - WASM uses extractBytes with pre-read bytes
		result = await extractBytes(documentBytes, "application/octet-stream", config);
	} catch (error) {
		if (shouldSkipFixture(error, "token_reduction_basic", [], undefined)) {
			return;
		}
		throw error;
	}
	if (result === null) {
		return;
	}
	assertions.assertExpectedMime(result, ["application/pdf"]);
	assertions.assertMinContentLength(result, 5);
	assertions.assertContentNotEmpty(result);
});

Deno.test("token_reduction_with_chunking", { permissions: { read: true } }, async () => {
	const documentBytes = await resolveDocument("pdf/fake_memo.pdf");
	const config = buildConfig({ chunking: { max_chars: 500, max_overlap: 50 }, token_reduction: { level: "medium" } });
	let result: ExtractionResult | null = null;
	try {
		// Sync file extraction - WASM uses extractBytes with pre-read bytes
		result = await extractBytes(documentBytes, "application/octet-stream", config);
	} catch (error) {
		if (shouldSkipFixture(error, "token_reduction_with_chunking", [], undefined)) {
			return;
		}
		throw error;
	}
	if (result === null) {
		return;
	}
	assertions.assertExpectedMime(result, ["application/pdf"]);
	assertions.assertMinContentLength(result, 5);
	assertions.assertChunks(result, 1, null, true, null);
	assertions.assertContentNotEmpty(result);
});
