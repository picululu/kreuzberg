// Code generated by kreuzberg-e2e-generator. DO NOT EDIT.
// To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang wasm-workers

// Tests for token_reduction fixtures. Cloudflare Workers with Vitest + Miniflare

import type { ExtractionResult } from "@kreuzberg/wasm";
import { extractBytes } from "@kreuzberg/wasm";
import { describe, expect, it } from "vitest";
import { assertions, buildConfig, getFixture, shouldSkipFixture } from "./helpers.js";

describe("token_reduction", () => {
	it("token_reduction_basic", async () => {
		const documentBytes = getFixture("pdf/fake_memo.pdf");
		if (documentBytes === null) {
			console.warn("[SKIP] Test skipped: fixture not available in Cloudflare Workers environment");
			return;
		}

		const config = buildConfig({ token_reduction: { level: "medium" } });
		let result: ExtractionResult | null = null;
		try {
			result = await extractBytes(documentBytes, "application/octet-stream", config);
		} catch (error) {
			if (shouldSkipFixture(error, "token_reduction_basic", [], undefined)) {
				return;
			}
			throw error;
		}
		if (result === null) {
			return;
		}
		assertions.assertExpectedMime(result, ["application/pdf"]);
		assertions.assertMinContentLength(result, 5);
		assertions.assertContentNotEmpty(result);
	});

	it("token_reduction_with_chunking", async () => {
		const documentBytes = getFixture("pdf/fake_memo.pdf");
		if (documentBytes === null) {
			console.warn("[SKIP] Test skipped: fixture not available in Cloudflare Workers environment");
			return;
		}

		const config = buildConfig({ chunking: { max_chars: 500, max_overlap: 50 }, token_reduction: { level: "medium" } });
		let result: ExtractionResult | null = null;
		try {
			result = await extractBytes(documentBytes, "application/octet-stream", config);
		} catch (error) {
			if (shouldSkipFixture(error, "token_reduction_with_chunking", [], undefined)) {
				return;
			}
			throw error;
		}
		if (result === null) {
			return;
		}
		assertions.assertExpectedMime(result, ["application/pdf"]);
		assertions.assertMinContentLength(result, 5);
		assertions.assertChunks(result, 1, null, true, null);
		assertions.assertContentNotEmpty(result);
	});
});
