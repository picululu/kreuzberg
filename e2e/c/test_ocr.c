/* Code generated by kreuzberg-e2e-generator. DO NOT EDIT. */
/* Category: ocr */

#include "helpers.h"
#include <stdio.h>

static void test_ocr_ocr_image_hello_world(void) {
    if (skip_if_feature_unavailable("tesseract")) return;
    CExtractionResult *result = run_extraction("images/test_hello_world.png", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"tesseract\",\"language\":\"eng\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"image/png"}, 1);
    assert_min_content_length(result, 5);
    assert_content_contains_any(result, (const char *[]){"hello", "world"}, 2);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_image_no_text(void) {
    if (skip_if_feature_unavailable("tesseract")) return;
    CExtractionResult *result = run_extraction("images/flower_no_text.jpg", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"tesseract\",\"language\":\"eng\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"image/jpeg"}, 1);
    assert_max_content_length(result, 200);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_paddle_confidence_filter(void) {
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    CExtractionResult *result = run_extraction("images/ocr_image.jpg", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"paddle-ocr\",\"language\":\"en\",\"paddle_ocr_config\":{\"min_confidence\":80.0}}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"image/jpeg"}, 1);
    assert_min_content_length(result, 1);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_paddle_element_hierarchy(void) {
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    CExtractionResult *result = run_extraction("images/test_hello_world.png", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"paddle-ocr\",\"element_config\":{\"build_hierarchy\":true,\"include_elements\":true},\"language\":\"en\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"image/png"}, 1);
    assert_min_content_length(result, 5);
    assert_ocr_elements(result, 1, 1, 1, 0, 0);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_paddle_element_levels(void) {
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    CExtractionResult *result = run_extraction("images/test_hello_world.png", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"paddle-ocr\",\"element_config\":{\"include_elements\":true,\"min_level\":\"word\"},\"language\":\"en\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"image/png"}, 1);
    assert_min_content_length(result, 5);
    assert_ocr_elements(result, 1, 1, 0, 1, 1);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_paddle_image_chinese(void) {
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    CExtractionResult *result = run_extraction("images/chi_sim_image.jpeg", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"paddle-ocr\",\"language\":\"ch\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"image/jpeg"}, 1);
    assert_min_content_length(result, 1);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_paddle_image_english(void) {
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    CExtractionResult *result = run_extraction("images/test_hello_world.png", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"paddle-ocr\",\"language\":\"en\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"image/png"}, 1);
    assert_min_content_length(result, 5);
    assert_content_contains_any(result, (const char *[]){"hello", "Hello", "world", "World"}, 4);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_paddle_markdown(void) {
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    CExtractionResult *result = run_extraction("images/test_hello_world.png", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"paddle-ocr\",\"language\":\"en\",\"paddle_ocr_config\":{\"output_format\":\"markdown\"}}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"image/png"}, 1);
    assert_min_content_length(result, 5);
    assert_content_contains_any(result, (const char *[]){"hello", "Hello", "world", "World"}, 4);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_paddle_pdf_scanned(void) {
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    CExtractionResult *result = run_extraction("pdf/ocr_test.pdf", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"paddle-ocr\",\"language\":\"en\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"application/pdf"}, 1);
    assert_min_content_length(result, 20);
    assert_content_contains_any(result, (const char *[]){"Docling", "Markdown", "JSON"}, 3);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_paddle_structured(void) {
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    CExtractionResult *result = run_extraction("images/test_hello_world.png", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"paddle-ocr\",\"element_config\":{\"include_elements\":true},\"language\":\"en\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"image/png"}, 1);
    assert_min_content_length(result, 5);
    assert_ocr_elements(result, 1, 1, 1, 0, 0);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_paddle_table_detection(void) {
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    if (skip_if_feature_unavailable("paddle-ocr")) return;
    CExtractionResult *result = run_extraction("images/simple_table.png", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"paddle-ocr\",\"language\":\"en\",\"paddle_ocr_config\":{\"enable_table_detection\":true}}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"image/png"}, 1);
    assert_min_content_length(result, 10);
    assert_table_count(result, 1, 1, 0, 0);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_pdf_image_only_german(void) {
    if (skip_if_feature_unavailable("tesseract")) return;
    CExtractionResult *result = run_extraction("pdf/image_only_german_pdf.pdf", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"tesseract\",\"language\":\"deu\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"application/pdf"}, 1);
    assert_min_content_length(result, 20);
    /* metadata assertion: format_type */
    if (result->metadata_json) { (void)str_contains_ci(result->metadata_json, "format_type"); (void)str_contains_ci(result->metadata_json, "{\"eq\":\"pdf\"}"); }
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_pdf_rotated_90(void) {
    if (skip_if_feature_unavailable("tesseract")) return;
    CExtractionResult *result = run_extraction("pdf/ocr_test_rotated_90.pdf", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"tesseract\",\"language\":\"eng\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"application/pdf"}, 1);
    assert_min_content_length(result, 10);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_pdf_tesseract(void) {
    if (skip_if_feature_unavailable("tesseract")) return;
    CExtractionResult *result = run_extraction("pdf/ocr_test.pdf", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"tesseract\",\"language\":\"eng\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"application/pdf"}, 1);
    assert_min_content_length(result, 20);
    assert_content_contains_any(result, (const char *[]){"Docling", "Markdown", "JSON"}, 3);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_tesseract_elements(void) {
    if (skip_if_feature_unavailable("tesseract")) return;
    CExtractionResult *result = run_extraction("images/test_hello_world.png", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"tesseract\",\"element_config\":{\"include_elements\":true},\"language\":\"eng\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"image/png"}, 1);
    assert_min_content_length(result, 5);
    assert_ocr_elements(result, 1, 1, 1, 0, 0);
    kreuzberg_free_result(result);
}

static void test_ocr_ocr_tesseract_language_german(void) {
    if (skip_if_feature_unavailable("tesseract")) return;
    CExtractionResult *result = run_extraction("pdf/image_only_german_pdf.pdf", "{\"force_ocr\":true,\"ocr\":{\"backend\":\"tesseract\",\"language\":\"deu\"}}");
    if (!result) return; /* skipped */
    assert_expected_mime(result, (const char *[]){"application/pdf"}, 1);
    assert_min_content_length(result, 20);
    kreuzberg_free_result(result);
}

int main(void) {
    test_ocr_ocr_image_hello_world();
    test_ocr_ocr_image_no_text();
    test_ocr_ocr_paddle_confidence_filter();
    test_ocr_ocr_paddle_element_hierarchy();
    test_ocr_ocr_paddle_element_levels();
    test_ocr_ocr_paddle_image_chinese();
    test_ocr_ocr_paddle_image_english();
    test_ocr_ocr_paddle_markdown();
    test_ocr_ocr_paddle_pdf_scanned();
    test_ocr_ocr_paddle_structured();
    test_ocr_ocr_paddle_table_detection();
    test_ocr_ocr_pdf_image_only_german();
    test_ocr_ocr_pdf_rotated_90();
    test_ocr_ocr_pdf_tesseract();
    test_ocr_ocr_tesseract_elements();
    test_ocr_ocr_tesseract_language_german();
    printf("test_ocr: all tests passed\n");
    return 0;
}
