# Generated by kreuzberg-e2e-generator. DO NOT EDIT.
HEADER_DIR ?= ../../crates/kreuzberg-ffi
LIBDIR ?= ../../target/debug
LIBNAME = kreuzberg_ffi

CC ?= cc
CFLAGS = -Wall -Wextra -I$(HEADER_DIR)

ifeq ($(shell uname),Darwin)
  LDFLAGS = -L$(LIBDIR) -l$(LIBNAME) -framework CoreFoundation -framework Security -lpthread
  RPATH = -Wl,-rpath,$(LIBDIR)
else ifeq ($(OS),Windows_NT)
  LDFLAGS = -L$(LIBDIR) -l$(LIBNAME) -lws2_32 -luserenv -lbcrypt
  RPATH =
else
  LDFLAGS = -L$(LIBDIR) -l$(LIBNAME) -lpthread -ldl -lm
  RPATH = -Wl,-rpath,$(LIBDIR)
endif

TESTS = test_archive test_contract test_email test_embeddings test_html test_image test_keywords test_ocr test_office test_pdf test_smoke test_structured test_token_reduction test_xml test_plugin_apis

.PHONY: all test clean

all: $(TESTS)

test: all
	@for t in $(TESTS); do echo "--- $$t ---" && ./$$t && echo "  PASS" || exit 1; done

test_archive: test_archive.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_archive.c helpers.c $(LDFLAGS)

test_contract: test_contract.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_contract.c helpers.c $(LDFLAGS)

test_email: test_email.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_email.c helpers.c $(LDFLAGS)

test_embeddings: test_embeddings.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_embeddings.c helpers.c $(LDFLAGS)

test_html: test_html.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_html.c helpers.c $(LDFLAGS)

test_image: test_image.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_image.c helpers.c $(LDFLAGS)

test_keywords: test_keywords.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_keywords.c helpers.c $(LDFLAGS)

test_ocr: test_ocr.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_ocr.c helpers.c $(LDFLAGS)

test_office: test_office.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_office.c helpers.c $(LDFLAGS)

test_pdf: test_pdf.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_pdf.c helpers.c $(LDFLAGS)

test_smoke: test_smoke.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_smoke.c helpers.c $(LDFLAGS)

test_structured: test_structured.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_structured.c helpers.c $(LDFLAGS)

test_token_reduction: test_token_reduction.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_token_reduction.c helpers.c $(LDFLAGS)

test_xml: test_xml.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_xml.c helpers.c $(LDFLAGS)

test_plugin_apis: test_plugin_apis.c helpers.c helpers.h
	$(CC) $(CFLAGS) $(RPATH) -o $@ test_plugin_apis.c helpers.c $(LDFLAGS)

clean:
	rm -f $(TESTS)
